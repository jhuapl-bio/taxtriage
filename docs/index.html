<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>TaxTriage Multi Run Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <script id="BOOTSTRAP" type="application/json">
      {
        "records": [
          {
            "Detected Organism": "★ Monkeypox virus",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 1.089,
            "# Reads Aligned": 1278,
            "% Aligned Reads": 1.093,
            "Coverage": 0.81,
            "HHS Percentile": 100.0,
            "IsAnnotated": "Yes",
            "AnnClass": "Direct",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 10244,
            "Status": "established",
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.78,
            "Mean MapQ": 56.58,
            "Mean Coverage": 0.81,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": "Zaire-96-I-16 (1.1%)",
            "K2 Reads": 654.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.92,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.969630234307046,
            "TASS Score": 0.99,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Listeria monocytogenes EGD-e",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 8.22,
            "# Reads Aligned": 9649,
            "% Aligned Reads": 8.25,
            "Coverage": 0.59,
            "HHS Percentile": 100.0,
            "IsAnnotated": "Yes",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 169963,
            "Status": "established",
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.83,
            "Mean MapQ": 57.9,
            "Mean Coverage": 0.59,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 4891.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.99,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.9228606101715086,
            "TASS Score": 0.98,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Listeria monocytogenes EGD-e",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 6.7,
            "# Reads Aligned": 201,
            "% Aligned Reads": 3.72,
            "Coverage": 0.3,
            "HHS Percentile": 100.0,
            "IsAnnotated": "Yes",
            "AnnClass": "Direct",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 169963,
            "Status": "established",
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 13.96,
            "Mean MapQ": 58.62,
            "Mean Coverage": 0.3,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": "EGD-e (3.7%)",
            "K2 Reads": 199.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.95,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.8245772575232647,
            "TASS Score": 0.96,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Severe acute respiratory syndrome coronavirus 2",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 0.085,
            "# Reads Aligned": 100,
            "% Aligned Reads": 0.085,
            "Coverage": 0.64,
            "HHS Percentile": 100.0,
            "IsAnnotated": "Yes",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 2697049,
            "Status": "established",
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.95,
            "Mean MapQ": 59.77,
            "Mean Coverage": 0.64,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 50.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.46,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.9358244518725628,
            "TASS Score": 0.96,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Salmonella enterica subsp. enterica serovar Typhimurium str. LT2",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 3.43,
            "# Reads Aligned": 103,
            "% Aligned Reads": 1.98,
            "Coverage": 0.09,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 99287,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 13.96,
            "Mean MapQ": 4.07,
            "Mean Coverage": 0.54,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 84.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.61,
            "Disparity Score": 0.89,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 1.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.6483270144507551,
            "TASS Score": 0.91,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Salmonella enterica subsp. enterica serovar Typhimurium",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 3.3,
            "# Reads Aligned": 99,
            "% Aligned Reads": 1.83,
            "Coverage": 0.08,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 90371,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 13.99,
            "Mean MapQ": 0.0,
            "Mean Coverage": 0.53,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 84.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.0,
            "Disparity Score": 0.89,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 1.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.6425918370115742,
            "TASS Score": 0.91,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Salmonella enterica subsp. enterica serovar Typhi str. Ty2",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 1.066,
            "# Reads Aligned": 32,
            "% Aligned Reads": 0.59,
            "Coverage": 0.05,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 209261,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 0.0,
            "Mean MapQ": 0.0,
            "Mean Coverage": 0.05,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.0,
            "Disparity Score": 0.68,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.5780135364738743,
            "TASS Score": 0.89,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Listeria monocytogenes serotype 4b str. F2365",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 0.46,
            "# Reads Aligned": 14,
            "% Aligned Reads": 0.25,
            "Coverage": 0.02,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 265669,
            "Status": null,
            "Gini Coefficient": 0.79,
            "Mean BaseQ": 0.0,
            "Mean MapQ": 0.0,
            "Mean Coverage": 0.02,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.0,
            "Disparity Score": 0.36,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.4387256824119404,
            "TASS Score": 0.7,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Salmonella enterica subsp. enterica",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 3.5,
            "# Reads Aligned": 105,
            "% Aligned Reads": 1.94,
            "Coverage": 0.09,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 59201,
            "Status": null,
            "Gini Coefficient": 0.67,
            "Mean BaseQ": 9.32,
            "Mean MapQ": 1.1,
            "Mean Coverage": 0.36,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 126.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.22,
            "Disparity Score": 0.9,
            "Minhash Score": 0.83,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 1.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.6497421081824434,
            "TASS Score": 0.68,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Escherichia coli O157:H7",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 15.057,
            "# Reads Aligned": 17666,
            "% Aligned Reads": 15.11,
            "Coverage": 0.55,
            "HHS Percentile": 100.0,
            "IsAnnotated": "Yes",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 83334,
            "Status": "established",
            "Gini Coefficient": 0.44,
            "Mean BaseQ": 21.74,
            "Mean MapQ": 14.95,
            "Mean Coverage": 0.2,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 27390.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.97,
            "Disparity Score": 1.0,
            "Minhash Score": 0.83,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 1.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.913161568498855,
            "TASS Score": 0.59,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Listeria monocytogenes serotype 4b str. F2365",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 0.086,
            "# Reads Aligned": 101,
            "% Aligned Reads": 0.086,
            "Coverage": 0.01,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 265669,
            "Status": null,
            "Gini Coefficient": 0.51,
            "Mean BaseQ": 32.44,
            "Mean MapQ": 1.37,
            "Mean Coverage": 0.01,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.27,
            "Disparity Score": 0.47,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.3017600515122467,
            "TASS Score": 0.48,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "★ Escherichia coli O157:H7",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 2.66,
            "# Reads Aligned": 80,
            "% Aligned Reads": 1.48,
            "Coverage": 0.09,
            "HHS Percentile": 100.0,
            "IsAnnotated": "Yes",
            "AnnClass": "Direct",
            "Microbial Category": "Primary",
            "High Consequence": true,
            "Taxonomic ID #": 83334,
            "Status": "established",
            "Gini Coefficient": 0.33,
            "Mean BaseQ": 0.0,
            "Mean MapQ": 0.0,
            "Mean Coverage": 0.03,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": "7.1_Anguil (1.5%)",
            "K2 Reads": 60.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.0,
            "Disparity Score": 0.86,
            "Minhash Score": 0.67,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 1.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.6445022051103892,
            "TASS Score": 0.45,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Pseudomonas aeruginosa PAO1",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 28.77,
            "# Reads Aligned": 33763,
            "% Aligned Reads": 28.89,
            "Coverage": 0.75,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": false,
            "Taxonomic ID #": 208964,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.85,
            "Mean MapQ": 30.85,
            "Mean Coverage": 0.75,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 1.0,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.9586959500243056,
            "TASS Score": 0.99,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Staphylococcus aureus subsp. aureus NCTC 8325",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 30.23,
            "# Reads Aligned": 907,
            "% Aligned Reads": 16.85,
            "Coverage": 0.58,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 93061,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 13.95,
            "Mean MapQ": 57.44,
            "Mean Coverage": 0.58,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 901.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 1.0,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.9210663530996837,
            "TASS Score": 0.98,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Escherichia coli str. K-12 substr. MG1655",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 13.18,
            "# Reads Aligned": 15465,
            "% Aligned Reads": 13.23,
            "Coverage": 0.6,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 511145,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.83,
            "Mean MapQ": 45.19,
            "Mean Coverage": 0.6,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 1.0,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.925378771999781,
            "TASS Score": 0.98,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Staphylococcus aureus subsp. aureus NCTC 8325",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 7.59,
            "# Reads Aligned": 8915,
            "% Aligned Reads": 7.62,
            "Coverage": 0.57,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 93061,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.79,
            "Mean MapQ": 48.35,
            "Mean Coverage": 0.57,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 4687.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.99,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.9194983879015513,
            "TASS Score": 0.98,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Human respiratory syncytial virus A",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 0.17,
            "# Reads Aligned": 201,
            "% Aligned Reads": 0.17,
            "Coverage": 0.97,
            "HHS Percentile": 100.0,
            "IsAnnotated": "Yes",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": false,
            "Taxonomic ID #": 208893,
            "Status": "established",
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.85,
            "Mean MapQ": 58.67,
            "Mean Coverage": 0.97,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 51.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.63,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 1.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.9963326727341124,
            "TASS Score": 0.98,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Staphylococcus aureus RF122",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 21.26,
            "# Reads Aligned": 638,
            "% Aligned Reads": 11.82,
            "Coverage": 0.43,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 273036,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 14.15,
            "Mean MapQ": 0.0,
            "Mean Coverage": 0.43,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.0,
            "Disparity Score": 0.99,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.8773118256581343,
            "TASS Score": 0.97,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Bacillus subtilis subsp. subtilis str. 168",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 29.1,
            "# Reads Aligned": 873,
            "% Aligned Reads": 16.17,
            "Coverage": 0.43,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 224308,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 13.96,
            "Mean MapQ": 0.67,
            "Mean Coverage": 0.43,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 873.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.14,
            "Disparity Score": 1.0,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.8774866466585093,
            "TASS Score": 0.97,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Bacillus subtilis BSn5",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 24.23,
            "# Reads Aligned": 727,
            "% Aligned Reads": 13.47,
            "Coverage": 0.37,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 936156,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 14.02,
            "Mean MapQ": 0.0,
            "Mean Coverage": 0.37,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.0,
            "Disparity Score": 1.0,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.8551615279373378,
            "TASS Score": 0.97,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Bacillus subtilis subsp. subtilis",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 28.93,
            "# Reads Aligned": 868,
            "% Aligned Reads": 16.083,
            "Coverage": 0.43,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 135461,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 13.96,
            "Mean MapQ": 0.0,
            "Mean Coverage": 0.43,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 873.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.0,
            "Disparity Score": 1.0,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.8774593168895832,
            "TASS Score": 0.97,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Bacillus subtilis subsp. subtilis str. 168",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 5.51,
            "# Reads Aligned": 6475,
            "% Aligned Reads": 5.54,
            "Coverage": 0.34,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 224308,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.8,
            "Mean MapQ": 1.05,
            "Mean Coverage": 0.34,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 7000.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.21,
            "Disparity Score": 0.99,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.8442138269580625,
            "TASS Score": 0.96,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Bacillus subtilis subsp. subtilis",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 5.52,
            "# Reads Aligned": 6456,
            "% Aligned Reads": 5.52,
            "Coverage": 0.34,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 135461,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.83,
            "Mean MapQ": 0.25,
            "Mean Coverage": 0.34,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 7000.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.06,
            "Disparity Score": 0.99,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.8446717479173239,
            "TASS Score": 0.96,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Limosilactobacillus fermentum",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 6.6,
            "# Reads Aligned": 198,
            "% Aligned Reads": 3.66,
            "Coverage": 0.26,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Unknown",
            "High Consequence": false,
            "Taxonomic ID #": 1613,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 13.96,
            "Mean MapQ": 59.72,
            "Mean Coverage": 0.62,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 396.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.95,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 1.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.8056047357320079,
            "TASS Score": 0.95,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Pseudomonas aeruginosa PA1",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 6.61,
            "# Reads Aligned": 7765,
            "% Aligned Reads": 6.64,
            "Coverage": 0.23,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": false,
            "Taxonomic ID #": 1279007,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.68,
            "Mean MapQ": 0.16,
            "Mean Coverage": 0.23,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 20812.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.04,
            "Disparity Score": 0.99,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.788149048768607,
            "TASS Score": 0.95,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "human respiratory syncytial virus B",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 0.042,
            "# Reads Aligned": 50,
            "% Aligned Reads": 0.042,
            "Coverage": 0.58,
            "HHS Percentile": 100.0,
            "IsAnnotated": "Yes",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": false,
            "Taxonomic ID #": 11250,
            "Status": "established",
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.2,
            "Mean MapQ": 58.24,
            "Mean Coverage": 0.58,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 76.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.3,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 1.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.9203948215088004,
            "TASS Score": 0.95,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Escherichia coli str. K-12 substr. MG1655",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 4.46,
            "# Reads Aligned": 134,
            "% Aligned Reads": 2.48,
            "Coverage": 0.17,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 511145,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 13.96,
            "Mean MapQ": 59.75,
            "Mean Coverage": 0.17,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.92,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.7446797064192892,
            "TASS Score": 0.94,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Enterococcus faecalis EnGen0336",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 3.0,
            "# Reads Aligned": 90,
            "% Aligned Reads": 1.66,
            "Coverage": 0.16,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 1169293,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 13.97,
            "Mean MapQ": 60.0,
            "Mean Coverage": 0.71,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.88,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.7348906406760972,
            "TASS Score": 0.93,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Bacillus subtilis BSn5",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 0.88,
            "# Reads Aligned": 1043,
            "% Aligned Reads": 0.89,
            "Coverage": 0.06,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 936156,
            "Status": null,
            "Gini Coefficient": 1.0,
            "Mean BaseQ": 32.86,
            "Mean MapQ": 0.95,
            "Mean Coverage": 0.06,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.2,
            "Disparity Score": 0.9,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.596729587645677,
            "TASS Score": 0.9,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Staphylococcus aureus RF122",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 0.36,
            "# Reads Aligned": 427,
            "% Aligned Reads": 0.36,
            "Coverage": 0.04,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 273036,
            "Status": null,
            "Gini Coefficient": 0.99,
            "Mean BaseQ": 32.57,
            "Mean MapQ": 1.24,
            "Mean Coverage": 0.04,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.25,
            "Disparity Score": 0.79,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.515197327002747,
            "TASS Score": 0.87,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Saccharomyces cerevisiae S288C",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 8.1,
            "# Reads Aligned": 243,
            "% Aligned Reads": 4.52,
            "Coverage": 0.1,
            "HHS Percentile": 100.0,
            "IsAnnotated": "Yes",
            "AnnClass": "Direct",
            "Microbial Category": "Commensal",
            "High Consequence": false,
            "Taxonomic ID #": 559292,
            "Status": "established",
            "Gini Coefficient": 0.87,
            "Mean BaseQ": 13.14,
            "Mean MapQ": 54.18,
            "Mean Coverage": 0.12,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": "Commensal Listing",
            "K2 Reads": 4012.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.96,
            "Minhash Score": 0.97,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 1.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.6678494497333848,
            "TASS Score": 0.83,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Pseudomonas aeruginosa PAO1",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 0.26,
            "# Reads Aligned": 8,
            "% Aligned Reads": 0.14,
            "Coverage": 0.02,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": false,
            "Taxonomic ID #": 208964,
            "Status": null,
            "Gini Coefficient": 0.9,
            "Mean BaseQ": 13.96,
            "Mean MapQ": 52.25,
            "Mean Coverage": 0.02,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 0.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.08,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.4241060923091868,
            "TASS Score": 0.75,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Pseudomonas aeruginosa PA1",
            "Specimen ID": "ONT_Run_A",
            "Sample Type": "stool",
            "% Reads": 0.23,
            "# Reads Aligned": 7,
            "% Aligned Reads": 0.12,
            "Coverage": 0.02,
            "HHS Percentile": 100.0,
            "IsAnnotated": "No",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": false,
            "Taxonomic ID #": 1279007,
            "Status": null,
            "Gini Coefficient": 0.88,
            "Mean BaseQ": 0.0,
            "Mean MapQ": 0.0,
            "Mean Coverage": 0.02,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 8.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 0.0,
            "Disparity Score": 0.0,
            "Minhash Score": 1.0,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 0.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.392205449558227,
            "TASS Score": 0.73,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          },
          {
            "Detected Organism": "Neisseria gonorrhoeae",
            "Specimen ID": "Miseq_Run_A",
            "Sample Type": "nasal",
            "% Reads": 6.071,
            "# Reads Aligned": 7123,
            "% Aligned Reads": 6.095,
            "Coverage": 0.59,
            "HHS Percentile": 100.0,
            "IsAnnotated": "Yes",
            "AnnClass": "Derived",
            "Microbial Category": "Primary",
            "High Consequence": false,
            "Taxonomic ID #": 485,
            "Status": "established",
            "Gini Coefficient": 0.5,
            "Mean BaseQ": 16.41,
            "Mean MapQ": 28.1,
            "Mean Coverage": 0.3,
            "Mean Depth": 0.0,
            "isSpecies": false,
            "Pathogenic Subsp/Strains": null,
            "K2 Reads": 7200.0,
            "Parent K2 Reads": 0,
            "MapQ Score": 1.0,
            "Disparity Score": 0.99,
            "Minhash Score": 0.75,
            "Diamond Identity": 0.0,
            "K2 Disparity Score": 1.0,
            "Siblings score": 0.0,
            "Breadth Weight Score": 0.9242778380193496,
            "TASS Score": 0.63,
            "MicrobeRT Model": null,
            "Group": "Unknown"
          }
        ],
        "all_cols": [
          "Detected Organism",
          "Specimen ID",
          "Sample Type",
          "% Reads",
          "# Reads Aligned",
          "% Aligned Reads",
          "Coverage",
          "HHS Percentile",
          "IsAnnotated",
          "AnnClass",
          "Microbial Category",
          "High Consequence",
          "Taxonomic ID #",
          "Status",
          "Gini Coefficient",
          "Mean BaseQ",
          "Mean MapQ",
          "Mean Coverage",
          "Mean Depth",
          "isSpecies",
          "Pathogenic Subsp/Strains",
          "K2 Reads",
          "Parent K2 Reads",
          "MapQ Score",
          "Disparity Score",
          "Minhash Score",
          "Diamond Identity",
          "K2 Disparity Score",
          "Siblings score",
          "Breadth Weight Score",
          "TASS Score",
          "MicrobeRT Model",
          "Group"
        ],
        "numeric_cols": [
          "% Reads",
          "# Reads Aligned",
          "% Aligned Reads",
          "Coverage",
          "HHS Percentile",
          "Taxonomic ID #",
          "Gini Coefficient",
          "Mean BaseQ",
          "Mean MapQ",
          "Mean Coverage",
          "Mean Depth",
          "K2 Reads",
          "Parent K2 Reads",
          "MapQ Score",
          "Disparity Score",
          "Minhash Score",
          "Diamond Identity",
          "K2 Disparity Score",
          "Siblings score",
          "Breadth Weight Score",
          "TASS Score",
          "MicrobeRT Model"
        ]
      }
    </script>

    <script>
      // read it back into JS variables
      let BOOT = JSON.parse(document.getElementById("BOOTSTRAP").textContent);
      let data = BOOT.records;
      let cols = BOOT.all_cols;
      let numericCols = BOOT.numeric_cols;
      let selectedCols = [...cols];
      let currentValueCol = numericCols.includes("TASS Score") ? "TASS Score" : numericCols[0];
    </script>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          sans-serif;
      }

      /* Top banner + legend */
      #top-banner {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 3em;
        background: #007bff;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        font-size: 1.2em;
        font-weight: 700;
      }
      #legend {
        position: fixed;
        top: 3em;
        left: 0;
        right: 0;
        background: #f0f0f0;
        padding: 0.5em 1em;
        z-index: 999;
      }

      /* Layout */
      #content-wrapper {
        position: absolute;
        top: calc(3em + 2em);
        bottom: 0;
        left: 0;
        right: 0;
        display: flex;
      }
      #content-area {
        flex: 1;
        position: relative;
        overflow-y: auto;
        padding: 1em;
      }
      #sidebar {
        width: 280px;
        border-left: 1px solid #ddd;
        background: #fafafa;
        padding: 1em;
        overflow-y: auto;
      }

      /* Tabs (in sidebar) */
      #tabs {
        display: flex;
        gap: 0.5em;
        margin-bottom: 1em;
      }
      #tabs button {
        flex: 1;
        padding: 0.5em;
        border: none;
        background: #007bff55;
        color: white;
        cursor: pointer;
        border-radius: 4px;
      }
      #tabs button.active {
        background: #0056aa;
        font-weight: 700;
      }

      /* Controls in sidebar */
      #sidebar label {
        display: block;
        margin-top: 0.75em;
        font-weight: 600;
      }
      #sidebar .row {
        display: flex;
        align-items: center;
        gap: 0.5em;
      }
      #sidebar input[type="text"],
      #sidebar input[type="number"],
      #sidebar select {
        width: 100%;
        margin-top: 0.25em;
        padding: 0.35em;
      }
      #sidebar input[type="color"] {
        width: 1.5em;
        height: 1.5em;
        padding: 0;
        border: none;
        background: none;
      }
      #upload-zone {
        border: 2px dashed #007bff;
        padding: 1em;
        text-align: center;
        margin-top: 0.75em;
        cursor: pointer;
        border-radius: 6px;
        background: #f8faff;
      }

      /* Content panes */
      .tab-content {
        position: absolute;
        inset: 0;
        overflow: auto;
        display: none;
      }
      .tab-content.active {
        display: block;
      }

      /* Heatmap */
      #heatmap {
        width: 100%;
        height: 640px;
      }

      /* Table */
      table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 0.5em;
      }
      th,
      td {
        border: 1px solid #999;
        padding: 0.25em 0.5em;
      }
      th {
        background: #eee;
        cursor: pointer;
        position: sticky;
        top: 0;
      }
      th.sorted {
        background: rgba(0, 255, 255, 0.2);
      }

      /* Loaded tables list */
      #table-list .item {
        display: flex;
        align-items: center;
        gap: 0.5em;
        padding: 0.25em 0;
      }
      #table-list .item span {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      #table-list .item button {
        background: none;
        border: none;
        cursor: pointer;
      }

      /* Sample color list */
      #sample-color-list ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      #sample-color-list li {
        display: flex;
        align-items: center;
        gap: 0.5em;
        margin: 0.25em 0;
      }
      #sample-color-list li span {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      #sample-color-list li button {
        background: none;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="top-banner">TaxTriage Multi Run Analysis</div>
    <div id="content-wrapper">
      <div id="content-area">
        <div id="heatmap-tab" class="tab-content active">
          <div id="heatmap"></div>
        </div>

        <div id="table-tab" class="tab-content">
          <div class="row" style="gap: 0.5em; align-items: center">
            <strong>Columns:&nbsp;</strong>
            <select multiple id="col-toggle" style="flex: 1; min-height: 4.5em"></select>
          </div>
          <table id="data-table">
            <thead>
              <tr id="header-row"></tr>
            </thead>
            <tbody id="table-body"></tbody>
          </table>
        </div>
      </div>

      <div id="sidebar">
        <!-- Tabs -->
        <div id="tabs">
          <button data-tab="heatmap" class="active">Heatmap</button>
          <button data-tab="table">Table</button>
        </div>

        <!-- Filters -->
        <label for="axis-filter">Filter (Specimen / Organism)</label>
        <input id="axis-filter" type="text" placeholder="e.g. ^sample" />
        <label class="row" style="margin-top: 0.5em; font-weight: 500">
          <input type="checkbox" id="ignore-case" checked />
          <span>Ignore case</span>
        </label>

        <label for="min-filter">Min Value (current column)</label>
        <input id="min-filter" type="number" step="0.05" value="0.6" placeholder="e.g. 0.5" />

        <label for="value-col">Heatmap Column</label>
        <select id="value-col"></select>

        <label class="row" style="margin-top: 0.75em">
          <input type="checkbox" id="show-annotations" checked />
          <span>Show cell values</span>
        </label>
        <label class="row" style="margin-top: 0.5em">
          <input type="checkbox" id="only-high-consequence" />
          <span>Show only High Consequence</span>
        </label>
        <div class="row">
          <input type="color" id="cell-text-color" value="#FFFFFF" />
          <small>Cell text color</small>
        </div>

        <!-- Upload -->
        <div id="upload-zone">
          Drop TSV here or click to upload
          <input type="file" id="file-upload" accept=".tsv,.txt" style="display: none" />
        </div>

        <!-- Loaded tables -->
        <label style="margin-top: 1em">Loaded Tables</label>
        <div id="table-list"></div>

        <!-- Per-sample colors -->
        <label style="margin-top: 1em">Sample Row Colors</label>
        <div id="sample-color-list">
          <ul></ul>
        </div>
      </div>
    </div>

    <script>
      /* --------------------------
       Data & State
    ---------------------------*/
      // Seed with a tiny default so UI works before uploads

      // let data = []
      // Columns & current metric
      // let cols = Object.keys(data[0] || {});
      // let numericCols = deriveNumericCols(data, cols);
      // let currentValueCol = 'TASS Score' || numericCols[0] || cols[0]

      // Tables management (each upload is a logical table)
      // entry: { name, data: [rows], hidden: false }
      let tables = [{ name: "default", data: structuredClone(data), hidden: false }];

      // Per-sample appearance & visibility
      const sampleColors = {}; // Specimen ID -> hex
      const sampleHidden = {}; // Specimen ID -> boolean

      // DOM handles
      const minInput = document.getElementById("min-filter");
      const showAnnInput = document.getElementById("show-annotations");
      const showonlyHighCons = document.getElementById("show-highonly");
      const cellColorInput = document.getElementById("cell-text-color");

      /* --------------------------
       Helpers
    ---------------------------*/
      function structuredClone(o) {
        return JSON.parse(JSON.stringify(o));
      }

      function deriveNumericCols(arr, columns) {
        if (!arr.length) return [];
        // consider a column numeric if ANY row parses to a number
        return columns.filter((c) => arr.some((r) => !isNaN(parseFloat(r[c]))));
      }
      function isTruthyHC(val) {
        if (typeof val === "boolean") return val;
        if (typeof val === "number") return val === 1;
        if (typeof val === "string") {
          const s = val.trim().toLowerCase();
          return s === "true" || s === "yes" || s === "y" || s === "1" || s === "t";
        }
        return false;
      }

      function recordIsHC(rec) {
        return isTruthyHC(rec?.["High Consequence"]);
      }

      // For table rows (in case the HC column isn't visible), look up the backing record
      function rowIsHC(specimen, organism) {
        const rec = data.find(
          (r) => (r["Specimen ID"] || "") === specimen && (r["Detected Organism"] || "") === organism,
        );
        return recordIsHC(rec);
      }

      function preprocessDetectedOrganisms(rows) {
        rows.forEach((r) => {
          if (typeof r["Detected Organism"] === "string") {
            r["Detected Organism"] = r["Detected Organism"].replace(/°/g, "").trim();
          }
        });
      }

      // Merge all non-hidden tables into the working data
      function getMergedData() {
        return tables.filter((t) => !t.hidden).flatMap((t) => t.data);
      }

      // Update state, rebuild UI, and redraw
      function updateData() {
        data = getMergedData();

        // Rebuild columns & numeric cols safely
        cols = Object.keys(data[0] || {});
        numericCols = deriveNumericCols(data, cols);

        if (!currentValueCol || !cols.includes(currentValueCol)) {
          currentValueCol = "TASS Score" || numericCols[0] || cols[0];
        }

        // UI pieces
        buildValueDropdown();
        populateColumnToggles();
        renderTableHeaders();
        populateTableData();
        renderSampleColorPickers();
        updateTableList();

        // Apply filters & draw plot
        applyTableFilter();
        redrawHeatmap();
      }

      // Get array of visible columns from multi-select
      function getVisibleColumns() {
        const sel = document.getElementById("col-toggle");
        const selected = Array.from(sel.selectedOptions).map((o) => o.textContent);
        if (!selected.length) return cols; // if nothing selected, show all
        // Only include existing cols
        return cols.filter((c) => selected.includes(c));
      }

      // Convert hex color to rgba with alpha
      function hexToRgba(hex, alpha = 0.2) {
        const m = hex.match(/^#?([A-F\d]{2})([A-F\d]{2})([A-F\d]{2})$/i);
        if (!m) return `rgba(0,0,0,${alpha})`;
        const r = parseInt(m[1], 16),
          g = parseInt(m[2], 16),
          b = parseInt(m[3], 16);
        return `rgba(${r},${g},${b},${alpha})`;
      }

      /* --------------------------
       Sidebar: Tabs
    ---------------------------*/
      document.querySelectorAll("#tabs button").forEach((btn) => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("#tabs button").forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          const tab = btn.dataset.tab;
          document.querySelectorAll(".tab-content").forEach((tc) => tc.classList.remove("active"));
          document.getElementById(tab + "-tab").classList.add("active");
        });
      });

      /* --------------------------
       Filters (sidebar)
    ---------------------------*/
      document.getElementById("axis-filter").addEventListener("input", () => {
        applyTableFilter();
        redrawHeatmap();
      });
      document.getElementById("ignore-case").addEventListener("change", () => {
        applyTableFilter();
        redrawHeatmap();
      });
      minInput.addEventListener("input", () => {
        applyTableFilter();
        redrawHeatmap();
      });
      showAnnInput.addEventListener("change", () => {
        redrawHeatmap();
      });
      cellColorInput.addEventListener("input", () => {
        redrawHeatmap();
      });
      const onlyHCInput = document.getElementById("only-high-consequence");
      onlyHCInput.addEventListener("change", () => {
        applyTableFilter();
        redrawHeatmap();
      });

      /* --------------------------
       Upload TSV (sidebar)
    ---------------------------*/
      const uploadZone = document.getElementById("upload-zone");
      const fileInput = document.getElementById("file-upload");

      uploadZone.addEventListener("click", () => fileInput.click());
      uploadZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadZone.style.background = "#e0f0ff";
      });
      uploadZone.addEventListener("dragleave", () => {
        uploadZone.style.background = "#f8faff";
      });
      uploadZone.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadZone.style.background = "#f8faff";
        const file = e.dataTransfer.files[0];
        if (file) readTSV(file);
      });
      fileInput.addEventListener("change", (e) => {
        const f = e.target.files[0];
        if (f) readTSV(f);
      });

      function readTSV(file) {
        const reader = new FileReader();
        reader.onload = () => {
          const lines = reader.result.trim().split(/\r?\n/);
          const headers = lines[0].split("\t");
          const jsonData = lines.slice(1).map((line) => {
            const values = line.split("\t");
            const entry = {};
            headers.forEach((h, i) => (entry[h.trim()] = values[i]));
            return entry;
          });
          initializeFromData(jsonData, file.name);
        };
        reader.readAsText(file);
      }

      function initializeFromData(newData, fileName) {
        preprocessDetectedOrganisms(newData);
        const base = fileName.replace(/^.*[\\/]/, "");
        tables.push({ name: base, data: newData, hidden: false });
        updateData();
      }

      /* --------------------------
       Loaded Tables list
    ---------------------------*/
      function updateTableList() {
        const container = document.getElementById("table-list");
        container.innerHTML = "";
        tables.forEach((t, idx) => {
          const row = document.createElement("div");
          row.className = "item";

          const name = document.createElement("span");
          name.textContent = t.name;
          row.appendChild(name);

          const hideBtn = document.createElement("button");
          hideBtn.innerHTML = t.hidden ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
          hideBtn.title = t.hidden ? "Show table" : "Hide table";
          hideBtn.addEventListener("click", () => {
            t.hidden = !t.hidden;
            updateData();
          });
          row.appendChild(hideBtn);

          const trashBtn = document.createElement("button");
          trashBtn.innerHTML = '<i class="fas fa-trash"></i>';
          trashBtn.title = "Remove table";
          trashBtn.addEventListener("click", () => {
            tables.splice(idx, 1);
            updateData();
          });
          row.appendChild(trashBtn);

          container.appendChild(row);
        });
      }

      /* --------------------------
       Per-sample color pickers + visibility
    ---------------------------*/
      function renderSampleColorPickers() {
        const ul = document.querySelector("#sample-color-list ul");
        ul.innerHTML = "";
        const specimens = Array.from(new Set(data.map((r) => r["Specimen ID"] || "")))
          .filter(Boolean)
          .sort();

        specimens.forEach((id) => {
          if (!sampleColors[id]) sampleColors[id] = "#d3d3d3";
          if (sampleHidden[id] === undefined) sampleHidden[id] = false;

          const li = document.createElement("li");

          const cp = document.createElement("input");
          cp.type = "color";
          cp.value = sampleColors[id];
          cp.addEventListener("input", () => {
            sampleColors[id] = cp.value;
            updateRowColors();
          });
          li.appendChild(cp);

          const lbl = document.createElement("span");
          lbl.textContent = id;
          li.appendChild(lbl);

          const eyeBtn = document.createElement("button");
          eyeBtn.innerHTML = sampleHidden[id] ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
          eyeBtn.title = sampleHidden[id] ? "Show sample" : "Hide sample";
          eyeBtn.addEventListener("click", () => {
            sampleHidden[id] = !sampleHidden[id];
            eyeBtn.innerHTML = sampleHidden[id] ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
            eyeBtn.title = sampleHidden[id] ? "Show sample" : "Hide sample";
            applyTableFilter();
            redrawHeatmap();
          });
          li.appendChild(eyeBtn);

          ul.appendChild(li);
        });
      }

      function updateRowColors() {
        const specimenIdx = cols.indexOf("Specimen ID");
        document.querySelectorAll("#table-body tr").forEach((tr) => {
          const sp = tr.cells[specimenIdx]?.textContent || "";
          const hex = sampleColors[sp] || "#d3d3d3";
          tr.style.backgroundColor = hexToRgba(hex, 0.18);
        });
      }

      /* --------------------------
       Heatmap
    ---------------------------*/
      function redrawHeatmap() {
        const txt = document.getElementById("axis-filter").value || "";
        const ic = document.getElementById("ignore-case").checked;
        const rx = txt ? new RegExp(txt, ic ? "i" : "") : null;
        const minRaw = minInput.value;
        const minVal = minRaw === "" ? -Infinity : parseFloat(minRaw);
        const onlyHC = onlyHCInput.checked;

        const fd = data.filter((r) => {
          const sp = r["Specimen ID"] || "";
          if (sampleHidden[sp]) return false; // sample-level hide

          const og = r["Detected Organism"] || "";
          const v = parseFloat(r[currentValueCol]);

          const passText = !rx || rx.test(sp) || rx.test(og);
          const passMin = !isNaN(v) && v >= minVal;
          const passHC = !onlyHC || recordIsHC(r);

          return passText && passMin && passHC;
        });

        const specimens = Array.from(new Set(fd.map((r) => r["Specimen ID"] || "")))
          .filter(Boolean)
          .sort();
        const organisms = Array.from(new Set(fd.map((r) => r["Detected Organism"] || "")))
          .filter(Boolean)
          .sort();

        const div = document.getElementById("heatmap");
        div.innerHTML = "";
        Plotly.purge(div);

        if (!specimens.length || !organisms.length || !currentValueCol) {
          Plotly.newPlot(div, [], {
            title: "No data available to render heatmap",
            xaxis: { title: "Specimen ID" },
            yaxis: { title: "Detected Organism" },
          });
          return;
        }

        // Build z and hovertext
        const z = organisms.map((o) =>
          specimens.map((s) => {
            const rec = fd.find((r) => (r["Detected Organism"] || "") === o && (r["Specimen ID"] || "") === s);
            const v = rec ? parseFloat(rec[currentValueCol]) : NaN;
            return isNaN(v) ? NaN : v;
          }),
        );

        const hoverText = organisms.map((o) =>
          specimens.map((s) => {
            const rec = fd.find((r) => (r["Detected Organism"] || "") === o && (r["Specimen ID"] || "") === s);
            return rec ? cols.map((c) => `${c}: ${rec[c]}`).join("<br>") : "";
          }),
        );

        // Custom colorscale (grey → light green → light orange → orange → light red → red)
        const customColorscale = [
          [0.0, "#D3D3D3"],
          [0.2, "#90EE90"],
          [0.4, "#FFD27F"],
          [0.6, "#FFA500"],
          [0.8, "#FF7F7F"],
          [1.0, "#FF0000"],
        ];

        const trace = {
          z,
          x: specimens,
          y: organisms,
          type: "heatmap",
          colorscale: customColorscale,
          hovertext: hoverText,
          hoverinfo: "text",
          hoverongaps: false,
          // Optionally set zmin/zmax if you want consistent color bounds:
          // zmin: 0, zmax: 1
        };

        const layout = {
          title: `Heatmap: ${currentValueCol}`,
          xaxis: { title: "Specimen ID", automargin: true },
          yaxis: { title: "Detected Organism", automargin: true },
          margin: { l: 150, t: 40, b: 80 },
          annotations: [],
        };

        // Add cell value annotations if enabled
        if (showAnnInput.checked) {
          const textColor = cellColorInput.value || "#FFFFFF";
          for (let i = 0; i < organisms.length; i++) {
            for (let j = 0; j < specimens.length; j++) {
              const val = z[i][j];
              layout.annotations.push({
                xref: "x",
                yref: "y",
                x: specimens[j],
                y: organisms[i],
                text: isNaN(val) ? "" : String(val),
                showarrow: false,
                font: { size: 12, color: textColor },
              });
            }
          }
        }

        Plotly.newPlot(div, [trace], layout, { responsive: true });
      }

      /* --------------------------
       Table (headers, sort, data, filter)
    ---------------------------*/
      function renderTableHeaders() {
        const headerRow = document.getElementById("header-row");
        headerRow.innerHTML = "";
        const visCols = getVisibleColumns();

        visCols.forEach((c, idx) => {
          const th = document.createElement("th");
          th.textContent = c;
          th.addEventListener("click", () => sortTableByColumn(idx, c, visCols));
          headerRow.appendChild(th);
        });
      }

      function populateColumnToggles() {
        const sel = document.getElementById("col-toggle");
        const prevSelection = new Set(Array.from(sel.selectedOptions).map((o) => o.textContent));
        sel.innerHTML = "";
        cols.forEach((c) => {
          const opt = document.createElement("option");
          opt.textContent = c;
          opt.selected = prevSelection.size ? prevSelection.has(c) : true; // select all by default
          sel.appendChild(opt);
        });
        sel.addEventListener("change", () => {
          renderTableHeaders();
          populateTableData();
          applyTableFilter();
        });
      }

      function populateTableData() {
        const tbody = document.getElementById("table-body");
        tbody.innerHTML = "";
        const visCols = getVisibleColumns();

        data.forEach((row) => {
          const tr = document.createElement("tr");
          visCols.forEach((c) => {
            const td = document.createElement("td");
            td.textContent = row[c];
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        updateRowColors();
      }

      function sortTableByColumn(idx, colName, visCols) {
        const tbody = document.getElementById("table-body");
        const rows = Array.from(tbody.rows);
        const asc = !(tbody.dataset.sortAsc === "true") || tbody.dataset.sortColumn !== colName;

        rows.sort((a, b) => {
          let va = a.cells[idx]?.textContent ?? "";
          let vb = b.cells[idx]?.textContent ?? "";
          if (numericCols.includes(colName)) {
            va = parseFloat(va);
            vb = parseFloat(vb);
            if (isNaN(va)) va = -Infinity;
            if (isNaN(vb)) vb = -Infinity;
            return asc ? va - vb : vb - va;
          } else {
            return asc ? va.localeCompare(vb) : vb.localeCompare(va);
          }
        });

        tbody.innerHTML = "";
        rows.forEach((r) => tbody.appendChild(r));
        tbody.dataset.sortAsc = asc;
        tbody.dataset.sortColumn = colName;
      }

      function applyTableFilter() {
        const txt = document.getElementById("axis-filter").value || "";
        const ic = document.getElementById("ignore-case").checked;
        const rx = txt ? new RegExp(txt, ic ? "i" : "") : null;

        const minRaw = minInput.value;
        const minVal = minRaw === "" ? -Infinity : parseFloat(minRaw);
        const onlyHC = onlyHCInput.checked;
        const visCols = getVisibleColumns();
        const specIdx = visCols.indexOf("Specimen ID");
        const orgIdx = visCols.indexOf("Detected Organism");
        const valIdx = visCols.indexOf(currentValueCol);

        Array.from(document.getElementById("table-body").rows).forEach((tr) => {
          const sp = specIdx >= 0 ? tr.cells[specIdx].textContent : "";
          const og = orgIdx >= 0 ? tr.cells[orgIdx].textContent : "";
          const valText = valIdx >= 0 ? tr.cells[valIdx].textContent : "";
          const v = parseFloat(valText);

          const passText = !rx || rx.test(sp) || rx.test(og);
          const passMin = !isNaN(v) && v >= minVal;
          const passSample = !sampleHidden[sp];
          const passHC = !onlyHC || rowIsHC(sp, og);

          tr.style.display = passText && passMin && passSample ? "" : "none";
        });
      }

      function buildValueDropdown() {
        const sel = document.getElementById("value-col");
        const prev = currentValueCol;
        sel.innerHTML = "";
        numericCols.forEach((col) => {
          const opt = document.createElement("option");
          opt.value = col;
          opt.textContent = col;
          if (col === prev) opt.selected = true;
          sel.appendChild(opt);
        });
        // If previous not available, select the first
        if (!sel.value && numericCols.length) sel.value = numericCols[0];
        currentValueCol = sel.value || currentValueCol;

        sel.onchange = (e) => {
          currentValueCol = e.target.value;
          applyTableFilter();
          redrawHeatmap();
        };
      }

      /* --------------------------
       Init
    ---------------------------*/
      // Initial build
      updateData();
    </script>
  </body>
</html>
